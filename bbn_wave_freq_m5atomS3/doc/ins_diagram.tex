\documentclass[11pt,letterpaper]{article}
\usepackage{fullpage}
\usepackage{amsmath, amssymb}
\usepackage{plantuml} % requires plantuml + java installed

% Configure plantuml for output directory
\plantumlset{outputdir=./build}

\begin{document}

Diagram:

\begin{plantuml}
@startuml
skinparam linetype ortho
rectangle "                         IMU                          " as IMU
rectangle "                                                                AHRS (Mahony, KalmanQMEKF)                                                     " as AHRS
rectangle "    Frequency Tracker:     \n\n  Aranovskiy\n  Kalm_ANF\n  Zero Crossing" as FreqTracker
rectangle "    Kalman Wave Direction  " as WaveDir
rectangle "         Sea State Detection          " as SeaReg
rectangle "                             Kalman Heave Reconstruction                   \n\n         Kalman Integration with Drift Correction         \nKalman Integration with Drift and Motor Noise Filtering" as KalmanWave
rectangle "Process Noise Adaptation" as NoiseAdapt
rectangle "                         NMEA Data Stream (XDR Sentences)                      " as NMEA
rectangle "         MinMaxLemire      " as MinMax
rectangle "   De-Spike  " as DeSpike
rectangle " Wave Profile Predictor " as WavePredictor

IMU --> AHRS : " accel "
IMU --> AHRS : " gyro "
IMU --> AHRS : " magn "
AHRS --> FreqTracker : <latex>$a_{z}$</latex>

FreqTracker --> SeaReg : <latex>$f_{est}$</latex>
AHRS --> SeaReg : <latex>$a_{z}$</latex>

AHRS --> WaveDir : <latex>$a_{x}, a_{y}$</latex>
FreqTracker --> WaveDir : <latex>$f_{est}$</latex>

SeaReg --> NoiseAdapt : <latex>$R_{reg}, H_{est}$</latex>

FreqTracker --> KalmanWave : <latex>$f_{est}$</latex>
NoiseAdapt --> KalmanWave : <latex>$Q$</latex>

AHRS --> DeSpike : <latex>$a_{z}$</latex>

DeSpike --> KalmanWave : <latex>$a_{z}$</latex>
KalmanWave --> MinMax : " heave "

KalmanWave --> WavePredictor : " heave "

WaveDir --> NMEA : " angle, dir "
MinMax --> NMEA : " wave height "
KalmanWave --> NMEA : " heave\n period\n length\n speed "
AHRS --> NMEA : " roll\n pitch\n yaw\n rate of turn "
@enduml
\end{plantuml}

\end{document}
