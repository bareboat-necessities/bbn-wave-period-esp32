\documentclass{article}
\usepackage{plantuml}
\usepackage{graphicx}
\usepackage{amsmath}

\begin{document}

\begin{plantuml}
@startuml
skinparam linetype ortho
rectangle "                         IMU                          " as IMU
rectangle "                                                                AHRS (Mahony, KalmanQMEKF)                                                     " as AHRS
rectangle "    Frequency Tracker:     \n\n  Aranovskiy\n  Kalm_ANF\n  Zero Crossing" as FreqTracker
rectangle "    Kalman Wave Direction  " as WaveDir
rectangle "         Sea State Detection          " as SeaReg
rectangle "                             Kalman Heave Reconstruction                   \n\n         Kalman Integration with Drift Correction         \nKalman Integration with Drift and Motor Noise Filtering" as KalmanWave
rectangle "Process Noise Adaptation" as NoiseAdapt
rectangle "                         NMEA Data Stream (XDR Sentences)                      " as NMEA
rectangle "         MinMaxLemire      " as MinMax
rectangle "   De-Spike  " as DeSpike
rectangle " Wave Profile Predictor " as WavePredictor

IMU --> AHRS : " accel "
IMU --> AHRS : " gyro "
IMU --> AHRS : " magn "
AHRS --> FreqTracker : $a_{z}$

FreqTracker --> SeaReg : $f_{est}$
AHRS --> SeaReg : $a_{z}$

AHRS --> WaveDir : $a_{x}, a_{y}$
FreqTracker --> WaveDir : $f_{est}$

SeaReg --> NoiseAdapt : $R_{reg}, H_{est}$

FreqTracker --> KalmanWave : $f_{est}$
NoiseAdapt --> KalmanWave : $Q$

AHRS --> DeSpike : $a_{z}$

DeSpike --> KalmanWave : $a_{z}$
KalmanWave --> MinMax : " heave "

KalmanWave --> WavePredictor : " heave "

WaveDir --> NMEA : " angle, dir "
MinMax --> NMEA : " wave height "
KalmanWave --> NMEA : " heave\n period\n length\n speed "
AHRS --> NMEA : " roll\n pitch\n yaw\n rate of turn "

@enduml
\end{plantuml}

\end{document}
